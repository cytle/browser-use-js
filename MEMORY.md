# Browser-Use JS 项目记忆

## 📅 2024-12-19

### 🎯 当前进度

**里程碑 2 进度**: 基础模块实现 - 50% 完成 (2/4 任务)

- ✅ T-004: DOM 核心处理器 (已完成)
- ✅ T-005: 可点击元素处理器 (已完成)
- [ ] T-006: 历史树处理器 (下一步)
- [ ] T-007: 浏览器核心控制器

### ✅ 已完成任务

#### T-001 项目基础配置搭建 ✅

- Vite + TypeScript + 热重载
- ESLint + Prettier + Husky
- 基础目录结构

#### T-003 测试框架配置 ✅

- Vitest + jsdom 环境
- 覆盖率阈值 80%
- CI/CD 流程 (GitHub Actions)
- 测试工具和辅助函数

#### T-004 DOM 核心处理器 ✅

- DOM 树遍历和分析
- 智能元素选择器生成
- Shadow DOM 支持
- 性能优化

#### T-005 可点击元素处理器 ✅

**核心功能**:

- 智能可点击元素识别 (标准 HTML + ARIA + 事件监听器)
- 框架组件检测 (React/Vue/Angular)
- 置信度评分算法 (0-1 范围)
- 可访问性信息收集

**性能优化**:

- 结果缓存 + MutationObserver 自动失效
- Shadow DOM 深度扫描
- 大型 DOM 树优化

### 📋 下一步: T-006 历史树处理器

**任务概述**: 页面变化追踪和状态管理

**验收标准**:

- DOM 变更历史记录
- 状态快照管理
- 回滚和恢复机制
- 内存优化的历史存储

**技术要求**: MutationObserver API + 高效数据结构

## 📚 核心知识点

### 可点击元素识别算法

**多维度评分权重**:

- 标准 HTML 元素: 0.9
- 事件监听器: 0.8
- ARIA 角色: 0.7
- CSS 样式: 0.6
- 框架组件: 0.5

### 框架检测技术

- **React**: `__react` 属性, `data-reactroot`
- **Vue**: `v-` 指令, `__vue` 属性
- **Angular**: `ng-` 属性

### 选择器生成策略

1. ID 选择器 (最高优先级)
2. 类名 + nth-of-type 组合
3. 路径选择器 (后备方案)
4. 特殊字符转义处理

### 测试框架要点

- **jsdom 限制**: 需手动设置 offset 属性
- **覆盖率**: v8 provider, 80% 阈值
- **Mock 工厂**: 统一创建接口, 类型安全

### 性能优化策略

- 结果缓存避免重复计算
- MutationObserver 监听变化
- TreeWalker 高效遍历
- 性能模式跳过昂贵检查
